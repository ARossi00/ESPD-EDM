
=== VIII.8 Treatment of Lots

When a procurement procedure is divided in Lots not all the selection criteria apply to all Lots, i.e. some
Lots need to be linked to specific criteria.

In the SELF-CONTAINED ESPD-EDM specification, instead of defining criteria per each Lot, it is for the criterion to
specify to which Lots it applies. This way one criterion may be applied to more than one Lot. This is the case notably
for the following criteria:

. *Suitability*, both 'enrolment' and 'for service contracts', see criteria #25 to #28 in the
link:https://github.com/ESPD/ESPD-EDM/blob/2.1.0/docs/src/main/asciidoc/dist/cl/xlsx/ESPD-CodeLists-V2.1.0.xlsx[code lists],
tabs _SC-Suitability-I_ and _SC-Suitability-II_;

. *Professional risk indemnity insurance*, see criterion #35 in tab _SC-Professional_risk_insurance_;

. *Other economic or financial requirements*, see criterion #36 in tab _SC-Other_economic_or_financial_;

. *References*, see criteria #37 to #39, in tab _SC-References_

To link a criterion with one or more Lots, the ESPD-EDM uses a GROUP (or SUBGROUP) of REQUIREMENTs, where each REQUIREMENT
specifies the identifier of each Lot that is affected by the criterion. Hence, if future evolutions of the ESPD-EDM required
that other criteria (additionally to the ones listed above) needed to specify the Lots to which they apply, the modification
would simply consist in adding a new GROUP of REQUIREMENTs. The figures below show how this is represented in the three different
criteria data structure listed above (''Professional risk indemnity'', ''Other economic or financial requirements'' and ''References'').

.'Risk indemnity insurance' criterion data structure (SELF-CONTAINED)
image::Selfcontained_Risk_Indemnity_Insurance_Data_Structure.png[Self-contained 'Risk indemnity insurance' criterion data structure, alt="Self-contained 'Risk indemnity insurance' criterion data structure",align="center"]

In this case (''Risk indemnity insurance'') there is one large REQUIREMENT_GROUP (with cardinality 1) that contains a large REQUIREMENT_SUBGROUP that can
be repeated *n* times. This repetitive SUBGROUP sets the identifier of one Lot (and only one) and a series of REQUIREMENTs and QUESTIONs
that apply to that Lot. Notice that the link has to be established only to one Lot, as each Lot has different properties (different REQUIREMENTs and QUESTIONs).

.Self-contained 'Other economic or financial requirements' criterion data structure
image::Selfcontained_References_Data_Structure.png[Self-contained 'Other economic or financial requirements' criterion data structure, alt="Self-contained 'Other economic or financial requirements' criterion data structure",align="center"]

In this case (''Other economic or financial requirements'') a large GROUP of one REQUIREMENT contains first one list of multiple Lots, and second the SUBGROUP of
REQUIREMENTs and QUESTIONs that are relatd to each of those Lots.

.Self-contained ''references' criterion data structure
image::Selfcontained_References_Data_Structure.png[Self-contained 'References' criterion data structure, alt="Self-contained 'References' criterion data structure",align="center"]

In this other case (''References'') one large GROUP of REQUIREMENTs contains first a specific SUBGROUP specifying one or more REQUIREMENTs
(e.g. "The references provided need to refer to works executed in more than one EU Member States.", other concrete REQUIREMENTS are possible here),
and the list of Lots to which these REQUIREMENTs apply. Next, there is a repetitive (1..n) GROUP of QUESTIONs intended for
the economic operator to specify each reference linked to one or more of Lots required by the contracting authority.
The list of Lots provided herein by the EO must be consistent with (1) the List of Lots provided by the CA for one
GROUP if specific REQUIREMENTs; and (2) with the List of Lots the EO declares it tenders to (provided by the EO as part of the data supplied by the Lead entity).

Let's see some examples of how this is implemented in XML.

Example fragment of XML for the ''Risk indemnity insurance'' criterion the following fragment of data structure.

.'Risk indemnity insurance' fragment
image::RiskIndeminityFragmentOfREQUIREMENT.png['Risk indemnity insurance' fragment, alt="'Risk indemnity insurance' fragment",align="center"]

.'Risk indemnity insurance' fragment (specification of one Lot in the ESPD-Request, by the CA)
[source,xml]
----
----

Example fragment of XML for the ''Other economic or financial requirements'' criterion the following fragment of data structure.

.'Other economic or financial requirements' fragment
image::OtherEOReqsFragmentOfREQUIREMENT.png['Other economic or financial requirements' fragment, alt="'Other economic or financial requirements' fragment",align="center"]

.'Other economic or financial requirements' fragment (specification of a group of Lots in the ESPD-Request, by the CA)
[source,xml]
----
----

.'Other economic or financial requirements' fragment (responses of the EO in the ESPD-Response)
[source,xml]
----
----

Example fragment of XML for the ''References'' criterion the following fragment of data structure.

.'References' fragment
image::ReferencesFragmentOfREQUIREMENT.png['References' fragment, alt="'References' fragment",align="center"]

.'References' fragment (specification of a group of Lots in the ESPD-Request, by the CA)
[source,xml]
----
----

.'References' fragment (responses of the EO in the ESPD-Response)
[source,xml]
----
----

For more complete examples on how the SELF-CONTAINED ESPD-Request specifies the criteria above mentioned see the
sub-sections link:#vi-6-2-self-contained-risk-indemnity-insurance[Self-contained risk indemnity insurance],
link:#vi-7-2-self-contained-other-economic-or-financial-requirements[VI.7.2 Self-contained other economic or financial requirements], and
link:#vi-8-2-self-contained-references[VI.8.2 Self-contained references].

See also the example illustrating how to respond in the case of
''References'' in the sub-section link:#viii-7-2-xml-example-2-references[VIII.7.2 XML Example 2: References].

The folder link:https://github.com/ESPD/ESPD-EDM/tree/2.1.0/docs/src/main/asciidoc/dist/xml[dist/xml] also contains
complete XML instances of both REGULATED and SELF-CONTAINED ESPD-Request and ESPD-Response documents.



